version: '3.2'
services:
  backend1:
    # tells Compose where to look for a Dockerfile to build the image 
    # for the service.
    build: ./backend
    # tells the container to keep running even when there’s no daemon 
    # specified via CMD in the Dockerfile. Otherwise, it’ll shut down 
    # right after provisioning 
    tty: true
    # defines where to put the server-side code in the container / Volumes 
    # are a storage mechanism within containers.
    volumes:
      - './backend/src:/backend-dir-inside-container'
  
  backend2:
    build: ./backend
    tty: true
    volumes:
      - './backend/src:/backend-dir-inside-container'
  
  backend3:
    build: ./backend
    tty: true
    volumes:
      - './backend/src:/backend-dir-inside-container'
  
  loadbalancer:
    build: ./load-balancer
    tty: true
    # makes sure the loadbalancer service doesn’t start unless the backend services 
    # have started. And it allows backend1 , backend2 and backend3 to be used as 
    # references within loadbalancer, which is used in nginx.conf
    links:
      - backend1
      - backend2
      - backend3
    ports:
      - '8080:8080'

volumes:
  backend: